/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2017 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global",".././library","sap/ui/core/Control"],function(q,l,C){"use strict";var a=C.extend("sap.ui.comp.smartmultiedit.Container",{metadata:{library:"sap.ui.comp",designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null,bindable:false},contexts:{type:"sap.ui.model.Context[]",group:"Misc",defaultValue:[],bindable:false}},defaultAggregation:"layout",aggregations:{layout:{type:"sap.ui.layout.form.Form",multiple:false,bindable:false}},events:{change:{}},associations:{}}});a.prototype.init=function(){this._bIsInitialized=false;this._bReadyToRender=false;this.attachEvent("modelContextChange",this._initializeMetadata,this);};a.prototype.setEntitySet=function(e){if(e!==this.getProperty("entitySet")){this.setProperty("entitySet",e,true);if(e){this._initializeMetadata();}}return this;};a.prototype.setContexts=function(v){if(q.isArray(v)){var F=sap.ui.require("sap/ui/model/Context");for(var i=0;i<v.length;i++){if(!(v[i]instanceof F)){return this;}}this.setProperty("contexts",v,true);}return this;};a.prototype.getAllUpdatedContexts=function(m){var c=this.getContexts(),u=[],t=this,i=0,s=10;if(c.length===0){return Promise.resolve(u);}return new Promise(function(r){function g(b,d,e){for(i=d;i<Math.min(e,b.length);i++){u.push({context:b[i],data:t._getUpdatedDataObject(b[i].getObject(),m)});}if(i<b.length){q.sap.delayedCall(0,null,g,[c,i,i+s]);}else{r(u);}}g(c,i,i+s);});};a.prototype._getUpdatedDataObject=function(o,m){var d=m?q.extend({},o):{},f=this._getFields(),p,r;for(var i=0;i<f.length;i++){p=f[i].getPropertyName();r=f[i].getRawValue();if(r.hasOwnProperty(p)&&r[p]!==o[p]){d[p]=r[p];}}return d;};a.prototype._initializeMetadata=function(){var m=this.getModel();if(!this._bIsInitialized&&this.getEntitySet()&&m&&(m.getMetadata().getName()==="sap.ui.model.odata.v2.ODataModel")){m.getMetaModel().loaded().then(this._onMetadataInitialized.bind(this));}};a.prototype._onMetadataInitialized=function(){var f,e,p=[];if(this._bIsInitialized){return;}f=this._getFields();e=this.getEntitySet();for(var i=0;i<f.length;i++){p.push(f[i].initialize(e));}Promise.all(p).then(function(){this._bIsInitialized=true;this._bReadyToRender=true;this.invalidate();}.bind(this));};a.prototype._getFields=function(){var f=this.getLayout(),F,b,c,L;if(f&&!this._aFields){this._aFields=[];F=f.getFormContainers();for(var i=0;i<F.length;i++){b=F[i].getFormElements();for(var j=0;j<b.length;j++){c=b[j].getFields();L=b[j].getLabel();for(var k=0;k<c.length;k++){this._registerField(c[k],L);}}}}return this._aFields||[];};a.prototype._registerField=function(f,b){var c=sap.ui.require("sap/ui/comp/smartmultiedit/Field");if(!(f instanceof c)){return;}if(b){f.setAssociation("ariaLabelledBy",b);}this._aFields.push(f);f.attachChange(this.fireChange,this);};return a;});
