/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2017 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/Label',"sap/m/VBox","sap/m/HBox",'sap/ui/comp/library','sap/ui/core/Element','sap/ui/layout/form/FormElement','sap/ui/comp/smartfield/SmartLabel','sap/ui/comp/smartfield/SmartField','sap/m/FlexItemData','sap/ui/core/VariantLayoutData','sap/ui/layout/GridData'],function(q,L,V,H,l,E,F,S,a,b,c,G){"use strict";var C=l.smartfield.ControlContextType;var d=F.extend("sap.ui.comp.smartform.GroupElement",{metadata:{library:"sap.ui.comp",properties:{useHorizontalLayout:{type:"boolean",group:"Misc",defaultValue:null},horizontalLayoutGroupElementMinWidth:{type:"int",group:"Misc",defaultValue:null},elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}},designTime:true},_bVisibleElements:false,_bHorizontalLayoutUsed:false});d._myVBox=undefined;d.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver.observe(this,{properties:["useHorizontalLayout","horizontalLayoutGroupElementMinWidth","elementForLabel"]});};d.prototype._getFieldRelevantForLabel=function(){var i=this.getElements();var I=this.getElementForLabel();if(i.length>I&&(i[I]instanceof a)){return i[I];}return null;};d.prototype._extractFields=function(i,I){var J=[];i.forEach(function(K){if(K instanceof V||K instanceof H){J=J.concat(K.getItems());}else{J.push(K);}});if(J.some(function(K){return K instanceof V||K instanceof H;})){J=this._extractFields(J);}if(I){J=J.filter(function(K){return!(K instanceof sap.m.Label);});}return J;};d.prototype.setTooltip=function(T){F.prototype.setTooltip.apply(this,[T]);var R=this._getFieldRelevantForLabel();var i=this._getLabel();_.call(this,i,R);return this;};function _(i,R){if(i==this._oSetLabel){return;}var T;if(this._oSetLabel&&this._oSetLabel instanceof sap.ui.core.Control){T=D.call(this._oSetLabel);}if(!T){T=D.call(this);}if(T){if(i instanceof S){if(R&&R.setTooltipLabel){R.setTooltipLabel(T);}}else{i.setTooltip(T);}}}d.prototype.setLabel=function(i){if(!i&&this._bMoveLabelToVBox){return this.setAggregation("label",i);}if(this._oSetLabel&&(typeof this._oSetLabel!=="string")){this._oSetLabel.detachEvent("_change",e,this);}var O;var I;var J;if(typeof i==="string"){O=this._getLabel();if(O){I=O.getText();}}else if(!i&&this._oSetLabel){I=this.getLabelText();}F.prototype.setLabel.apply(this,[i]);this._oSetLabel=i;f.call(this);if(typeof i==="string"){if(this._oLabel instanceof S&&i!=I&&(i.length>0||I.length>0)){J=this._getFieldRelevantForLabel();if(J&&i!=null){if(J.getTextLabel){if(!J._oTextLabelSetByGroupElement){J._oTextLabelSetByGroupElement={oldText:J.getTextLabel()};}J.setTextLabel(i);}}}if(!this._bHorizontalLayoutUsed){this.setAggregation("_label",this._oLabel,true);}this._oLabel.isRequired=g;this._oLabel.isDisplayOnly=h;}else{if(i){if(i.isRequired){i.isRequired=g;}if(i.isDisplayOnly){i.isDisplayOnly=h;}i.attachEvent("_change",e,this);}else{J=this._getFieldRelevantForLabel();if(J){A.call(this,J,I);}}this.updateLabelOfFormElement();}return this;};d.prototype.destroyLabel=function(){var O=this.getLabelText();F.prototype.destroyLabel.apply(this);delete this._oSetLabel;f.call(this);var i=this._getFieldRelevantForLabel();if(i){A.call(this,i,O);}this.updateLabelOfFormElement();return this;};function e(i){if(i.getParameter("name")=="text"){var I=i.oSource;var T=I.getText();if(this._oLabel){this._oLabel.setText(T);}var J=this._getFieldRelevantForLabel();if(J&&J.getTextLabel){if(!J._oTextLabelSetByGroupElement){J._oTextLabelSetByGroupElement={oldText:J.getTextLabel()};}J.setTextLabel(T);}}}function f(){if(!this._bHorizontalLayoutUsed){return;}var i=this.getFields();var O;if(i.length>0){var I=this.getFields()[0];if(I instanceof V){var J=I.getItems();var N=this._getLabel();if(J.length>0&&J[0]instanceof L){O=J[0];}this._bMoveLabelToVBox=true;if(O&&O!=N){I.removeItem(0);if(O._bCreatedByGroupElement){this.setAggregation("_label",O,true);}else{this.setAggregation("label",O);}}if(N&&O!=N){I.insertItem(N,0);}this._bMoveLabelToVBox=false;j.call(this);}}}function g(){if(this.getRequired&&this.getRequired()){return true;}var I=this.getParent();if(I instanceof sap.m.VBox){I=I.getParent();}var J=I.getElements();for(var i=0;i<J.length;i++){var K=J[i];if(K.getRequired&&K.getRequired()===true&&(!K.getEditable||K.getEditable())&&(!K.getContextEditable||K.getContextEditable())){return true;}}return false;}function h(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly();}var i=this.getParent();if(i instanceof sap.m.VBox){i=i.getParent();}var I=i.getParent();if(I){var J=I.getParent();if(J){return!J.getEditable();}}}return false;}function j(){var i=this._getFieldRelevantForLabel();if(i){if(this._oLabel){this._oLabel.setLabelFor(i);}return;}var I=this.getFields();i=I.length>0?I[0]:null;if(i instanceof V){var J=i.getItems();if(J[1]instanceof H){i=J[1].getItems()[0];}else{i=J[1];}}var K=this._oLabel;if(K){K.setLabelFor(i);}else{K=this.getLabel();if(K instanceof sap.ui.core.Control){K.setAlternativeLabelFor(i);}}}d.prototype.getLabel=function(){return this._oSetLabel;};d.prototype._getLabel=function(){if(this._oLabel){return this._oLabel;}else{return this._oSetLabel;}};d.prototype.getLabelControl=function(){if(this._bHorizontalLayoutUsed){return null;}else{return this._getLabel();}};d.prototype.getLabelText=function(){var i="";var I=this._getLabel();if(I){i=I.getText();}return i;};d.prototype._createLabel=function(i){var I=null;var J=this._getFieldRelevantForLabel();if(J){if(J.getShowLabel&&J.getShowLabel()){I=new S(J.getId()+'-label');if(i){if(!J._oTextLabelSetByGroupElement){J._oTextLabelSetByGroupElement={oldText:J.getTextLabel()};}J.setTextLabel(i);I.setText(i);}I.setLabelFor(J);}}else{I=new L();I.setText(i);}if(I){I._bCreatedByGroupElement=true;I.isRequired=g;I.isDisplayOnly=h;this._oLabel=I;if(!this.getUseHorizontalLayout()){this.setAggregation("_label",I,true);}if(this._oSetLabel&&typeof this._oSetLabel!=="string"){this._oSetLabel.setAlternativeLabelFor(null);}}return I;};d.prototype.updateLabelOfFormElement=function(){var i=false,O=null;var I=this.getElements();var R=this._getFieldRelevantForLabel();var J=this._getLabel();var K=false;if(J&&J._bCreatedByGroupElement){if(J instanceof S){if(!R||(J._sSmartFieldId&&J._sSmartFieldId!=R.getId())){K=true;}}else if(R){K=true;}if(K){J.destroy();delete this._oLabel;J=null;if(this._oSetLabel&&!R){if(typeof this._oSetLabel==="string"){F.prototype.setLabel.apply(this,[this._oSetLabel]);J=this._oLabel;this._oLabel.isRequired=g;this._oLabel.isDisplayOnly=h;}else{J=this._oSetLabel;}f.call(this);}}}else if(J&&R){if(J==this._oLabel){J.destroy();delete this._oLabel;}J=null;}if(!J){if(this._oSetLabel){if(typeof this._oSetLabel==="string"){O=this._oSetLabel;}else{O=this._oSetLabel.getText();}}else{O="";}}if(!J&&I.length>0){J=this._createLabel(O);i=true;}if(J){if(J instanceof S){if(R&&R.setTextLabel&&R.getTextLabel()){J.setText(R.getTextLabel());}}_.call(this,J,R);}if(i){f.call(this);if(J&&J.setLabelFor&&!(J instanceof S)&&!R&&(I.length>0)){J.setLabelFor(I[0]);}}};d.prototype.setEditMode=function(i){var I=this.getElements();I.forEach(function(J){if(J instanceof a){if(!(J.data("editable")===false)){J.setContextEditable(i);}}});return this;};d.prototype.invalidateLabel=function(){var i=this._getLabel();if(i){i.invalidate();}};d.prototype._updateFormElementVisibility=function(){var i=this.getVisibleBasedOnElements();if(this._bVisibleElements!==i){this._bVisibleElements=i;if(this.isPropertyInitial("visible")){s.call(this);this.invalidate();}}};d.prototype._updateLayout=function(){var i=null;var I=null;var J=[];var K=[];var M=null;var U=this.getUseHorizontalLayout();var N;var O=0;var P;if(U==this._bHorizontalLayoutUsed){return;}if(this._bHorizontalLayoutUsed){K=this.getFields();J=this._extractFields(K,true);}else{J=this.getFields();}var Q=this._getLabel();this._bNoObserverChange=true;if(U){if(J.length>0&&J[0].getLayoutData()){M=J[0].getLayoutData();}this.removeAllFields();if(J.length>0){if(J.length>1){for(O=0;O<J.length;O++){P=J[O];if(O>0){k.call(this,P);}}I=o.call(this,J.slice(0));}if(I){N=[I];}else{N=J.slice(0);}i=n.call(this,N,Q,M);this.addField(i);if(Q){j.call(this);}}}else{if(K[0]instanceof V){i=K[0];N=i.getItems();if(J.length>1&&N.length>0){if(Q){if(N.length>1&&N[1]instanceof H){I=N[1];}}else if(N[0]instanceof H){I=N[0];}if(I){I.removeAllItems();I.destroy();}}i.removeAllItems();i.destroy();}this.removeAllFields();for(O=0;O<J.length;O++){P=J[O];m.call(this,P);this.addField(P);}if(Q){if(Q==this._oLabel){this.setAggregation("_label",Q,true);}else{this.setAggregation("label",Q);}}}this._bHorizontalLayoutUsed=U;this._bNoObserverChange=false;};function k(i){var I=i.getLayoutData();if(I){if(I.getStyleClass&&!I.getStyleClass()){I.setStyleClass("sapUiCompGroupElementHBoxPadding");}}else{I=new sap.m.FlexItemData({styleClass:"sapUiCompGroupElementHBoxPadding"});I._bCreatedByGroupElement=true;i.setLayoutData(I);}}function m(i){var I=i.getLayoutData();if(I){if(I._bCreatedByGroupElement){I.destroy();}else if(I.getStyleClass&&I.getStyleClass()=="sapUiCompGroupElementHBoxPadding"){I.setStyleClass();}}}function n(i,I,J){if(!d._myVBox){d._myVBox=V.extend("SmartFormVBox",{metadata:{interfaces:["sap.ui.core.IFormContent"]},enhanceAccessibilityState:p,renderer:"sap.m.VBoxRenderer"});}this._bMoveLabelToVBox=true;var K=i.slice(0);if(I){K.splice(0,0,I);}var M=new d._myVBox(this.getId()+"--VBox",{"items":K});this._bMoveLabelToVBox=false;M.addStyleClass("sapUiCompGroupElementVBox");M._oGroupElement=this;if(J&&(J instanceof G||J instanceof c||J.getMetadata().getName()=="sap.ui.layout.ResponsiveFlowLayoutData")){M.setLayoutData(J.clone());}r.call(this,M);return M;}function o(i){var I=new H(this.getId()+"--HBox",{"items":i});I._oGroupElement=this;I.enhanceAccessibilityState=p;return I;}function p(i,I){var J=this._oGroupElement._getLabel();if(J&&J!=i&&!(i instanceof H)){var K=I["labelledby"];if(!K){K=J.getId();}else{var M=K.split(" ");if(q.inArray(J.getId(),M)<0){M.splice(0,0,J.getId());K=M.join(" ");}}I["labelledby"]=K;}return I;}d.prototype._updateGridDataSpan=function(){if(!this.getUseHorizontalLayout()){return;}var i=this.getFields();if(i.length>0){var I=i[0];if(I instanceof V){r.call(this,I);}}};function r(I){var J=this.getParent();if(!J||!J.addGroupElement){return;}var K=J.getParent();while(K&&!K.addGroup&&K.getParent){K=K.getParent();}if(!K){return;}var M="";var N=K.getLayout();if(N){M=N.getGridDataSpan();}var O=I.getLayoutData();var P;if(O){if(!(O instanceof G)&&!(O instanceof c)&&M){P=new G({span:M});P._bFromGroupElement=true;var Q=new c({multipleLayoutData:[O,P]});Q._bFromGroupElement=true;I.setLayoutData(Q);}else if(O instanceof G){if(O._bFromGroupElement){if(!M){O.destroy();}else{O.setSpan(M);}}}else if(O instanceof c){var R=false;O.getMultipleLayoutData().forEach(function(O){if(O instanceof G){R=true;if(O._bFromGroupElement){if(!M){O.destroy();}else{O.setSpan(M);}}}});if(!R&&M){P=new G({span:M});P._bFromGroupElement=true;O.addMultipleLayoutData(P);}if(O._bFromGroupElement&&O.getMultipleLayoutData().length==1){P=O.getMultipleLayoutData()[0];I.setLayoutData(P);O.destroy();}}}else if(M){P=new G({span:M});P._bFromGroupElement=true;I.setLayoutData(P);}var T=this.getElements();for(var i=0;i<T.length;i++){var U=T[i];if(U&&U.setControlContext){if(M){U.setControlContext(C.SmartFormGrid);}else{U.setControlContext(C.Form);}}}}d.prototype._setLinebreak=function(I,J,K,M){if(!this.getUseHorizontalLayout()){return;}var N=this.getFields();if(N.length>0){var O=N[0];if(!(O instanceof V)){return;}var P=O.getLayoutData();if(P){if(P instanceof c){var Q=P.getMultipleLayoutData();for(var i=0;i<Q.length;i++){P=Q[i];if(P instanceof G){P.setLinebreakXL(I);P.setLinebreakL(J);P.setLinebreakM(K);P.setLinebreakS(M);}}}else{P.setLinebreakXL(I);P.setLinebreakL(J);P.setLinebreakM(K);P.setLinebreakS(M);}}}};d.prototype.setVisible=function(i){var I=this.isVisible();F.prototype.setVisible.apply(this,arguments);if(I!=i){s.call(this);}return this;};d.prototype.isVisible=function(){if(this.isPropertyInitial("visible")){return this._bVisibleElements;}else{return this.getVisible();}};function s(){this.fireVisibleChanged({visible:this.isVisible()});if(this.getParent()){this.getParent()._updateLineBreaks();}}d.prototype.getFormElement=function(){return this;};d.prototype.addElement=function(i){if(!i){return this;}i=this.validateAggregation("elements",i,true);u.call(this,i);var I;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){I=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){t.call(this,i,undefined,true);}else{this.addField(i);}if(I&&I!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(I);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype.insertElement=function(i,I){if(!i){return this;}i=this.validateAggregation("elements",i,true);u.call(this,i);var J;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){J=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){t.call(this,i,I,false);}else{this.insertField(i,I);}if(J&&J!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(J);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype.getElements=function(){var i;var I;if(this.getUseHorizontalLayout()){i=this.getFields();I=this._extractFields(i,true);}else{I=this.getFields();}return I;};d.prototype.indexOfElement=function(I){var J=-1;if(this.getUseHorizontalLayout()){var K=this.getElements();for(var i=0;i<K.length;i++){if(I==K[i]){J=i;break;}}}else{J=this.indexOfField(I);}return J;};d.prototype.removeElement=function(i){var R;var I;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){I=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){R=y.call(this,i,false);}else{R=this.removeField(i);}if(R){z.call(this,R);}if(I&&I!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(I);}this.updateLabelOfFormElement();this._updateFormElementVisibility();return R;};d.prototype.removeAllElements=function(){var R;if(this.getUseHorizontalLayout()){R=y.call(this,undefined,true);}else{R=this.removeAllFields();}if(R&&Array.isArray(R)){for(var i=0;i<R.length;i++){z.call(this,R[i]);}}this.updateLabelOfFormElement();this._updateFormElementVisibility();return R;};d.prototype.destroyElements=function(){if(this.getUseHorizontalLayout()){var i=this.getFields();if(i.length>0){var I=this._getLabel();if(I){i[0].removeItem(I);if(I==this._oLabel){this.setAggregation("_label",I,true);}else{this.setAggregation("label",I);}}this.destroyFields();}}else{this.destroyFields();}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this;};d.prototype._observeChanges=function(i){F.prototype._observeChanges.apply(this,arguments);if(i.object==this){switch(i.name){case"useHorizontalLayout":this._updateLayout();break;case"horizontalLayoutGroupElementMinWidth":q.sap.log.error("HorizontalLayoutGroupElementMinWidth is deprecated",this);this._updateLayout();break;case"elementForLabel":this.updateLabelOfFormElement();break;default:break;}}else{x.call(this,i);}};function t(i,I,J){var K=this._getLabel();var M=this.getFields();var N;var O;var P;if(M.length>0){N=M[0];}else{P=[i];var Q=i.getLayoutData();N=n.call(this,P,K,Q);this.addField(N);if(K){j.call(this);}return;}if(!(N instanceof V)){return;}P=N.getItems();if(K){if(P.length>1){O=P[1];}}else if(P.length>0){O=P[0];}if(O instanceof H){P=O.getItems();if((J||I>0)&&P.length>0){k.call(this,i);}if(J){O.addItem(i);}else{if(I==0&&P.length>0){k.call(this,P[0]);}O.insertItem(i,I);}}else{var R=O;P=[];if(R){N.removeItem(R);if(J||I>0){P.push(R);P.push(i);k.call(this,i);}else{P.push(i);P.push(R);k.call(this,R);}O=o.call(this,P);N.addItem(O);}else{N.addItem(i);}if(K){j.call(this);}}}function u(i){if(i.getEditable){if(!i.getEditable()){i.data("editable",false);}}this._oObserver.observe(i,{properties:["visible"]});if(i.attachInnerControlsCreated){i.attachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(C.Form);}if(i.getMetadata().getProperty("mandatory")){this._oObserver.observe(i,{properties:["mandatory"]});}v.call(this,i);}function v(I){if(I instanceof a){var J=this.getCustomData();for(var i=0;i<J.length;i++){w.call(this,I,J[i]);}}}function w(i,I){if(i instanceof a&&sap.ui.comp.smartform.inheritCostomDataToFields(I)){var N=I.clone();N._bFromGroupElement=true;N._sOriginalId=I.getId();i.addCustomData(N);}}function x(i){if(i.name=="mandatory"){this.invalidateLabel();}else if(i.name=="visible"){this._updateFormElementVisibility();}}function y(I,J){var K=this._getLabel();var M=this.getFields();var N;var O;var P;var R;var Q=false;var T;if(M.length>0){N=M[0];}if(!(N instanceof V)){return null;}P=N.getItems();if(K){if(P.length>1){O=P[1];}}else if(P.length>0){O=P[0];}if(O instanceof H){if(J){R=O.removeAllItems();Q=true;}else{R=O.removeItem(I);P=O.getItems();if(P.length>0){m.call(this,P[0]);if(P.length==1){T=P[0];O.removeAllItems();N.removeItem(O);O.destroy();N.addItem(T);}}}}else{if(J){R=N.removeAllItems();}else{R=N.removeItem(I);}if(R){Q=true;}}if(Q){if(K){N.removeItem(K);if(K==this._oLabel){this.setAggregation("_label",K,true);}else{this.setAggregation("label",K);}}this.removeField(N);N.destroy();}if(R){if(Array.isArray(R)){for(var i=0;i<R.length;i++){T=R[i];m.call(this,T);}}else{m.call(this,R);}}return R;}function z(i){if(i.detachInnerControlsCreated){i.detachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(C.None);}B.call(this,i);A.call(this,i,this.getLabelText());}function A(i,I){if(i._oTextLabelSetByGroupElement){if(i.getTextLabel()==I){i.setTextLabel(i._oTextLabelSetByGroupElement.oldText);}delete i._oTextLabelSetByGroupElement;}}function B(I,O){if(I instanceof a){var J=I.getCustomData();for(var i=0;i<J.length;i++){var K=J[i];if(K._bFromGroupElement&&(!O||O==K._sOriginalId)){I.removeCustomData(K);K.destroy();}}}}d.prototype._updateFormElementLabel=function(i){var R=this._getFieldRelevantForLabel();var I=this._getLabel();var J=i.oSource;var K=i.getParameters();if(I instanceof S&&J&&K&&J===R){I.updateLabelFor(K);}};d.prototype.addCustomData=function(I){if(!I){return this;}F.prototype.addCustomData.apply(this,arguments);var J=this.getElements();for(var i=0;i<J.length;i++){w.call(this,J[i],I);}return this;};d.prototype.insertCustomData=function(I,J){if(!I){return this;}F.prototype.insertCustomData.apply(this,arguments);var K=this.getElements();for(var i=0;i<K.length;i++){w.call(this,K[i],I);}return this;};d.prototype.removeCustomData=function(I){var J=F.prototype.removeCustomData.apply(this,arguments);if(J){var K=this.getElements();for(var i=0;i<K.length;i++){B.call(this,K[i],J.getId());}}return J;};d.prototype.removeAllCustomData=function(){var I=F.prototype.removeAllCustomData.apply(this,arguments);if(I.length>0){var J=this.getElements();for(var i=0;i<J.length;i++){B.call(this,J[i]);}}return I;};d.prototype.destroyCustomData=function(){F.prototype.destroyCustomData.apply(this,arguments);var I=this.getElements();for(var i=0;i<I.length;i++){B.call(this,I[i]);}return this;};d.prototype.getVisibleBasedOnElements=function(){var i=false;var I=this.getElements();if(I&&I.length>0){i=I.some(function(J){return J.getVisible();});}return i;};function D(){var T=this.getTooltip();if(!T||typeof T==="string"||T instanceof String){return T;}else{return T.getText();}}d.prototype.clone=function(I,J){var K=this.removeAllElements();var M=F.prototype.clone.apply(this,arguments);for(var i=0;i<K.length;i++){var N=K[i];var O=N.clone(I,J);this.addElement(N);M.addElement(O);}return M;};return d;},true);
