(function(g){"use strict";sap.ui.define(['sap/ushell/renderers/fiori2/search/controls/SearchResultListSelectionHandler','sap/ushell/renderers/fiori2/search/esh/api/release/sina'],function(D){var a=D.getMetadata().getName();jQuery.sap.declare('sap.ushell.renderers.fiori2.search.SearchConfiguration');var u={multiSelect:{type:'bool'},sinaProvider:{type:'string'},odataProvider:{type:'bool'},searchBusinessObjects:{type:'bool'},charts:{type:'bool'},maps:{type:'bool'},newpie:{type:'bool'},personalizationStorage:{type:'string'}};var S=sap.ushell.renderers.fiori2.search.SearchConfiguration=function(){this.init.apply(this,arguments);};S.prototype={init:function(p){try{var c=g['sap-ushell-config'].renderers.fiori2.componentData.config.esearch;jQuery.extend(true,this,c);}catch(e){}this.handleOutdatedConfigurationParameters();this.setDefaults();this.readUrlParameters();this.setModulePaths();this.createDefaultDataSourceConfig();},setModulePaths:function(){if(!this.modulePaths){return;}for(var i=0;i<this.modulePaths.length;++i){var m=this.modulePaths[i];jQuery.sap.registerModulePath(m.moduleName,m.urlPrefix);}},handleOutdatedConfigurationParameters:function(){try{var c=g['sap-ushell-config'].renderers.fiori2.componentData.config;if(c.searchBusinessObjects!==undefined&&this.searchBusinessObjects===undefined){if(c.searchBusinessObjects==='hidden'||c.searchBusinessObjects===false){this.searchBusinessObjects=false;}else{this.searchBusinessObjects=true;}}if(c.enableSearch!==undefined&&this.enableSearch===undefined){this.enableSearch=c.enableSearch;}}catch(e){}},setDefaults:function(){if(this.searchBusinessObjects===undefined){this.searchBusinessObjects=true;}if(this.odataProvider===undefined){this.odataProvider=false;}if(this.multiSelect===undefined){this.multiSelect=true;}if(this.charts===undefined){this.charts=true;}if(this.maps===undefined){this.maps=false;}if(this.newpie===undefined){this.newpie=false;}if(this.dataSources===undefined){this.dataSources={};}if(this.enableSearch===undefined){this.enableSearch=true;}if(this.personalizationStorage===undefined){this.personalizationStorage='auto';}this.dataSourceConfigurations=this.semanticObjects||{};this.semanticObjects=undefined;this.documentDataSource={searchResultListItem:'sap.ushell.renderers.fiori2.search.controls.SearchResultListItemDocument'};this.dataSourceConfigurations['noteprocessorurl']=this.dataSourceConfigurations['noteprocessorurl']||{};this.dataSourceConfigurations['noteprocessorurl'].searchResultListItem=this.dataSourceConfigurations['noteprocessorurl'].searchResultListItem||'sap.ushell.renderers.fiori2.search.controls.SearchResultListItemNote';this.dataSourceConfigurations['noteprocessorurl'].searchResultListSelectionHandler=this.dataSourceConfigurations['noteprocessorurl'].searchResultListSelectionHandler||'sap.ushell.renderers.fiori2.search.controls.SearchResultListSelectionHandlerNote';},prepareDataSourceConfigurationForCertainObjectTypes:function(b,d){var c=this.dataSourceConfigurations[b]||{};if(d&&d.isDocumentConnector){if(!c.searchResultListItem){c.searchResultListItem=this.documentDataSource.searchResultListItem;}else{var m="Will attempt to load '"+c.searchResultListItem+"' instead of '"+this.documentDataSource.searchResultListItem+"' for semantic object '"+b+"'";jQuery.sap.log.warning(m,'sap.ushell.renderers.fiori2.search.SearchConfiguration');}}this.dataSourceConfigurations[b]=c;return c;},createDefaultDataSourceConfig:function(){this.defaultDataSourceConfig={searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:a,searchResultListSelectionHandlerControl:D};},readUrlParameters:function(){var p=this.parseUrlParameters();for(var b in p){if(b==='demoMode'){this.searchBusinessObjects=true;this.enableSearch=true;continue;}var c=u[b];if(!c){continue;}var v=p[b];switch(c.type){case'bool':v=(v==='true'||v==='');break;default:}this[b]=v;}},parseUrlParameters:function(){var U=sap.ushell.Container.getService("URLParsing");var p=U.parseParameters(g.location.search);var n={};for(var k in p){var v=p[k];if(v.length!==1){continue;}v=v[0];if(typeof v!=='string'){continue;}n[k]=v;}return n;},loadCustomModulesAsync:function(){var t=this;if(t._loadCustomModulesProm){return t._loadCustomModulesProm;}var d,b=[];for(var c in t.dataSourceConfigurations){d=t.loadCustomModulesForSemanticObjectAsync(c);b.push(d);}t._loadCustomModulesProm=Promise.all(b);return t._loadCustomModulesProm;},loadCustomModulesForDataSourcesAsync:function(d,b){var c=[];for(var i=0;i<d.length;i++){var e=Array.isArray(b)&&b.length>i&&b[i]||{};var f=this.loadCustomModulesForDataSourceAsync(d[i],e);c.push(f);}return Promise.all(c);},loadCustomModulesForDataSourceAsync:function(d,b){b=b||{};var c=this._getSemanticObjectNameFromDataSource(d);return this.loadCustomModulesForSemanticObjectAsync(c,b);},loadCustomModulesForSemanticObjectAsync:function(b,d){if(!b){return Promise.resolve();}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};var c=this._dataSourceLoadingProms[b];if(!c){var e=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];var f=this.prepareDataSourceConfigurationForCertainObjectTypes(b,d);var h,j=[];for(var i=0;i<e.length;i++){h=this._doLoadCustomModulesAsync(b,f,e[i].moduleAttrName,e[i].controlAttrName);j.push(h);}c=Promise.all(j);c._resolvedOrFailed=false;c.then(function(){c._resolvedOrFailed=true;});this._dataSourceLoadingProms[b]=c;}return c;},_doLoadCustomModulesAsync:function(b,d,m,c,f,h){var t=this;return new Promise(function(r,i){if(d[m]&&(!d[c]||d[c]==t.defaultDataSourceConfig[c])){try{sap.ui.require([d[m].replace(/[.]/g,'/')],function(k){d[c]=k;r();});}catch(e){var j="Could not load custom module '"+d[m]+"' for data source with semantic object name '"+b+"'. ";j+="Falling back to default data source configuration.";jQuery.sap.log.warning(j,'sap.ushell.renderers.fiori2.search.SearchConfiguration');d[m]=f||t.defaultDataSourceConfig[m];d[c]=h||t.defaultDataSourceConfig[c];r();}}else{if(!d[c]){d[m]=f||t.defaultDataSourceConfig[m];d[c]=h||t.defaultDataSourceConfig[c];}r();}});},getDataSourceConfig:function(d){var b=this._getSemanticObjectNameFromDataSource(d);if(!b||(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[b]&&!this._dataSourceLoadingProms[b]._resolvedOrFailed)){return this.defaultDataSourceConfig;}var c=this.dataSourceConfigurations[b];if(!c){c=this.defaultDataSourceConfig;this.dataSourceConfigurations[b]=c;}return c;},_getSemanticObjectNameFromDataSource:function(d){var b=d.semanticObjectType;if(!b){if(d.semanticObjectTypes&&d.semanticObjectTypes.length==1){b=d.semanticObjectTypes[0];}else if(d.getObjectNameAsString){b=d.getObjectNameAsString();}else if(d.getIdentifier){b=d.getIdentifier();}}return b;},isLaunchpad:function(){try{return!!sap.ushell.Container.getService("CrossApplicationNavigation");}catch(e){return false;}},getSina:function(){if(!this.isSinaRegistered){if(!this.odataProvider&&this.isLaunchpad()){sap.ushell.Container.addRemoteSystem(new sap.ushell.System({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH"}));this.sina=g.sina.getSina();}else{this.sina=g.sina.getSina({'impl_type':"odata2",'servicePath':window.location.pathname.slice(0,window.location.pathname.indexOf('/sap/ushell/renderers/fiori2/search/container/'))+'/es/odata/callbuildin.xsjs'});}}this.isSinaRegistered=true;return this.sina;}};var s;S.getInstance=function(){if(s){return s}s=new S();return s;};return S;});})(window);
