// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define([],function(){"use strict";var c={token:null},a=n.bind(null,c),b=l.bind(null,c),d=m.bind(null,c),e=q.bind(null,g,t);return Object.create(null,{executeRequest:{value:g},executeRequestWithCsrfToken:{value:f},isSafeHttpMethod:{value:j},isValidHttpMethod:{value:k},summariseResponse:{value:s},processResponse:{value:p},getHttpRequestWrapper:{value:h},containsCSRFTokenHeaderEntry:{value:i},csrfTokenReadFromCache:{value:b},csrfTokenWriteToCache:{value:d},csrfTokenIsCached:{value:a},_csrfTokenFetch:{value:q},csrfTokenFetch:{value:e},_csrfTokenGet:{value:o},csrfTokenGet:{value:o.bind(null,a,b,d,e)},csrfTokenAddToRequestHeader:{value:r},csrfTokenExtractFromResponseHeader:{value:t}});function f(E,C,u,v,w,x,I,R,U,y){var z;if(!/String/.test(Object.prototype.toString.call(R))||!/String/.test(Object.prototype.toString.call(U))||!/Function/.test(Object.prototype.toString.call(E))||!/Function/.test(Object.prototype.toString.call(C))||!/Function/.test(Object.prototype.toString.call(v))||!/Function/.test(Object.prototype.toString.call(u))||!/Function/.test(Object.prototype.toString.call(w))||!/Function/.test(Object.prototype.toString.call(x))||!/Function/.test(Object.prototype.toString.call(I))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}if(!y){y={};}return new Promise(function(A,B){function D(F){jQuery.sap.log.error(F,null,"sap.ushell.util.HttpClient");B(F);}if(!I(R)){u(U).then(function(F){z=w(F,y);return E(R,U,z);}).then(function(F){A(F);}).catch(function(F){if(F&&(F.status===403)&&(x(F).toLowerCase()==="required")){v(U).then(function(G){z=w(G,y);return E(R,U,z);}).then(function(G){A(G);}).catch(D);}else{D(F);}});}else{z=w("fetch",y);E(R,U,z).then(function(F){var G=x(F);if(G){C(G);}A(F);}).catch(D);}});}function g(R,u,C){var H,v;var x=new XMLHttpRequest();if(!/String/.test(Object.prototype.toString.call(R))||!/String/.test(Object.prototype.toString.call(u))){throw new Error("IllegalArgumentException: one or more of the arguments is invalid");}if(/[a-z]/.test(R)){R=R.toUpperCase();}if(C){H=!C.headers?[]:Object.keys(C.headers).map(function(w){return{name:w,value:this[w]};},C.headers);v=C.data;}else{H=[];}return new Promise(function(w,y){["load","error"].forEach(function(E){x.addEventListener(E,p.bind(null,x,w,y));});x.open(R,u);H.forEach(function(z){x.setRequestHeader(z.name,z.value);});x.send(JSON.stringify(v));});}function h(M,H,B,C){if(!/String/.test(Object.prototype.toString.call(M))||!/Function/.test(Object.prototype.toString.call(H))||!/String/.test(Object.prototype.toString.call(B))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return function(P,S){return H(M,B.replace(/\/$/,"")+"/"+P.replace(/^\//,""),jQuery.extend({},C,S));};}function p(x,O,E){var R;if(!x||!/Number/.test(Object.prototype.toString.call(x.status))||!/Function/.test(Object.prototype.toString.call(x.getAllResponseHeaders))){throw new Error("IllegalArgumentError: invalid XMLHttpRequest instance");}R=s(x);if(x.status<200||x.status>299){E(R);}else{O(R);}}function s(x){return{status:x.status,statusText:x.statusText,responseText:x.responseText,responseHeaders:x.getAllResponseHeaders().split(/\r\n/g).filter(function(I){return I.length>0;}).map(function(H){var P=H.split(":");return{name:P[0].trim(),value:P[1].trim()};})};}function i(H){var u=H["x-csrf-token"]||H["X-CSRF-TOKEN"];return!!u&&/String/.test(Object.prototype.toString.call(u));}function j(H){switch(H){case"HEAD":case"GET":case"OPTIONS":return true;case"POST":case"PUT":case"DELETE":return false;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function k(H){switch(H){case"HEAD":case"GET":case"OPTIONS":case"POST":case"PUT":case"DELETE":return true;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function l(C){return C.token;}function m(C,N){C.token=N;}function n(C){return C.token?true:false;}function o(C,u,v,w,U){return new Promise(function(x,y){if(C()){x(u());}else{w(U).then(function(z){v(z);x(z);}).catch(function(E){y(E);})}});}function q(E,C,u){return E("OPTIONS",u,{headers:{"x-csrf-token":"fetch"}}).then(function(R){return C(R);});}function r(H,C){var E,O={"x-csrf-token":H};if(!/String/.test(Object.prototype.toString.call(H))||!/object Object/.test(Object.prototype.toString.call(C))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}E=jQuery.extend(true,{},C);if(!E.headers){E.headers=O;}else{jQuery.extend(E.headers,O);}return E;}function t(R){var C;if(!/Array/.test(Object.prototype.toString.call(R.responseHeaders))){return undefined;}C=R.responseHeaders.filter(function(H){return H.name==="x-csrf-token";})[0];return C&&C.value?C.value:undefined;}});
