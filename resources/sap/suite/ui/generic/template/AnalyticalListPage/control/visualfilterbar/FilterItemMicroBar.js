sap.ui.define(["sap/suite/ui/microchart/InteractiveBarChart","sap/suite/ui/microchart/InteractiveBarChartBar","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroChart","sap/suite/ui/generic/template/AnalyticalListPage/util/CriticalityUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil"],function(I,a,J,F,C,b){"use strict";var c=F.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",{metadata:{properties:{fixedCount:{type:"int",defaultValue:3},labelWidthPercent:{type:"float",group:"Misc",defaultValue:1/3}},aggregations:{control:{type:"sap.suite.ui.microchart.InteractiveBarChart",multiple:false}}},renderer:{}});c.prototype.init=function(){this._chart=new sap.suite.ui.microchart.InteractiveBarChart({maxDisplayedBars:3,selectionEnabled:true,bars:[]});this.setControl(this._chart);this.setModel(new J(),'__alp_chartJSONModel');this._sorters=[];F.prototype.init.apply(this,arguments);};c.prototype._updateBinding=function(){this.applyOverlay();this._chart.setBusyIndicatorDelay(0);this._chart.setBusy(true);this._chart.unbindBars();var e=this.getEntitySet(),d=this.getDimensionField(),f=this.getDimensionFieldDisplay(),m=this.getMeasureField(),u=this.getUnitField(),g=this.getDimensionFilterExternal(),s=[],S=this.getSortOrder(),o=F._getSorter(S);this._sorters=o.sorter;s=o.sortFields;if(!e||!m||!d||!f){return;}var h=[m,d,s];if(d!=f){h.push(f);}if(u){h.push(u);}var i=[];if(g&&g.aFilters&&g.aFilters.length){i=[g];}var j=this;var k=this.getFixedCount();var M=this.getModel();var B="/"+e;if(M){var D=C.getDataPoint(M,this);if(D){(D.ValueFormat&&D.ValueFormat.ScaleFactor)?this.setScaleFactor(b.getPrimitiveValue(D.ValueFormat.ScaleFactor)):this.setScaleFactor(null);(D.ValueFormat&&D.ValueFormat.NumberOfFractionalDigits)?this.setNumberOfFractionalDigits(b.getPrimitiveValue(D.ValueFormat.NumberOfFractionalDigits)):this.setNumberOfFractionalDigits(null);var r=C.getCriticalityRefProperties(D);}if(this.getSmartFilterId()){var l=sap.ui.getCore().byId(this.getSmartFilterId());if(l&&l.getEntitySet()===e){var t=this.getModel("_templPriv"),n=t.getProperty('/alp/searchable');if(n){B=this.considerAnalyticBinding(B,l);}else{this.applyOverlay(this.requiredFilterMessage);return;}}}if(this._oObject){this._oObject.abort();}this._oObject=M.read(B,{async:true,filters:i,sorters:this._sorters,urlParameters:{"$select":r?[r].concat(h).join(","):h.join(","),"$top":k},success:function(p,q){j._oObject=null;p=D?C.CalculateCriticality(D,p,j.getMeasureField()):p;j._onDataReceived(p);},error:function(E){jQuery.sap.log.error("Error reading URL:"+E);if(E&&E.statusCode!==0&&E.statusText!=="abort"){j.applyOverlay(j.technicalIssueMessage);j._oObject=null;}}});}};c.prototype._onDataReceived=function(d){if(!d||!d.results||!d.results.length){this.applyOverlay(this.noDataIssueMessage);return;}F.prototype._onDataReceived.call(this,d.results);this.getModel('__alp_chartJSONModel').setData(d.results);this._chart.setModel(this.getModel('__alp_chartJSONModel'));var e=this.getFixedCount(),f={path:'/',template:new a(this._getChartAggregationSettings()),startIndex:0,length:e};this._chart.bindBars(f);this._chart.setBusy(false);};return c;},true);
