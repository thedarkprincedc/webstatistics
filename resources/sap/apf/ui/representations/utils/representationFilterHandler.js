/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.utils.representationFilterHandler");jQuery.sap.require("sap.apf.ui.representations.utils.displayOptionHandler");(function(){'use strict';function _(m,f,r){var v=[];var A=m.map(function(d){return d[r];});v=f.filter(function(F){return A.indexOf(F)!==-1;});return v;}function a(f){return f.filter(function(i,n,F){return F.indexOf(i)===n;});}function b(r,m,M){var n,s;var l=r.oParameter.requiredFilterOptions?r.oParameter.requiredFilterOptions.labelDisplayOption:undefined;var R=r.oDisplayOptionHandler.getColumnNameBasedOnDisplayOption(r.oParameter.requiredFilters[0],l,m);r.filterValues.forEach(function(f){for(n=0;n<M.length;n++){if(M[n][r.oParameter.requiredFilters[0]]===f){s=M[n][R];break;}}r.filterValueLookup[f]=s;});}sap.apf.ui.representations.utils.RepresentationFilterHandler=function(A,p,t){this.oApi=A;this.filterValues=[];this.oParameter=p;this.sRequiredFilter=this.oParameter.requiredFilters[0];this.oDisplayOptionHandler=new sap.apf.ui.representations.utils.DisplayOptionHandler();this.filterValueLookup={};this.oTimeAxisDateConverter=t;};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.constructor=sap.apf.ui.representations.utils.RepresentationFilterHandler;sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.setMetadata=function(m){this.oMetadata=m;};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.createFilterFromSelectedValues=function(n){var f=this,i=false,v;var F=this.filterValues;var o=this.oApi.createFilter();if(n&&n.length>0){F=a(n.concat(F));}var A=o.getTopAnd().addOr('exprssionOr');var E=o.getOperators().EQ;i=f.oTimeAxisDateConverter.bIsConversionToDateRequired(this.oParameter.requiredFilters[0],this.oMetadata);F.forEach(function(r){if(i){v=f.oTimeAxisDateConverter.getConvertedDateLookUp()[r]||r;}else{v=r;}var c={id:r,name:f.sRequiredFilter,operator:E,value:v};A.addExpression(c);});return o;};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.updateFilterFromSelection=function(f){var u=a(f);this.filterValues=u.slice(0);};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.clearFilters=function(){this.filterValues=[];};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getDisplayInfoForFilters=function(m,M){var f=[],r=this;var R=r.oParameter.requiredFilters[0];this.filterValues=_(M,r.filterValues,R);b(r,m,M);r.filterValues.forEach(function(c){var F={id:c,text:r.filterValueLookup[c]};f.push(F);});return f;};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getFilterValues=function(){return this.filterValues;};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getIfSelectedFilterChanged=function(n){var i=(jQuery(this.filterValues).not(n).length===0)&&(jQuery(n).not(this.filterValues).length===0);return!i;};}());
