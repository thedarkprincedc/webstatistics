// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};sap.ovp.cards.AnnotationHelper.NumberFormatFunctions={};sap.ovp.cards.AnnotationHelper.DateFormatFunctions={};sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions={};sap.ovp.cards.AnnotationHelper.criticalityConstants={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};sap.ovp.cards.AnnotationHelper.AnnotationType={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement"};sap.ovp.cards.AnnotationHelper.TextArrangementType={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};sap.ovp.cards.AnnotationHelper.formatterGeo=function(i,j){var k=j.Longitude.Path;var k1=j.Latitude.Path;return"{path:'"+k+"'}; {path:'"+k1+"'}"+";0";};sap.ovp.cards.AnnotationHelper.analyticRegions=function(i,j){return"{path:'"+j.CountryCode.Path+"'}";};sap.ovp.cards.AnnotationHelper.getLabelStateFromValue=function(i){var j;switch(i){case"Default":j=sap.ui.vbm.SemanticType.Default;break;case"Error":j=sap.ui.vbm.SemanticType.Error;break;case"Warning":j=sap.ui.vbm.SemanticType.Warning;break;case"Success":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.getColorStateFromValue=function(i){var j;switch(i){case"0":j="#5E696E";break;case"1":j="#BB0000";break;case"2":j="#E78C07";break;case"3":j="#2B7D2B";break;default:j="#5E696E";break;}return j;};sap.ovp.cards.AnnotationHelper.criticalityType=function(i,j){var k=j.Criticality.Path;return"{path:'"+k+"', formatter: 'sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue' }";};sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue=function(i){var j;switch(i){case"0":j=sap.ui.vbm.SemanticType.Default;break;case"1":j=sap.ui.vbm.SemanticType.Error;break;case"2":j=sap.ui.vbm.SemanticType.Warning;break;case"3":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.labelText=function(i,j){var k=i.getSetting('ovpCardProperties');var k1=k.getProperty('/showLabelText');if(k1==="true"){var l1=j.Address[0];if(typeof l1.country!=="undefined"){return"{path:'"+l1.country.Path+"'}";}else if(typeof l1.locality!=="undefined"){return"{path:'"+l1.locality.Path+"'}";}else if(typeof l1.street!=="undefined"){return"{path:'"+l1.street.Path+"'}";}else if(typeof l1.code!=="undefined"){return"{path:'"+l1.code.Path+"'}";}}else{return null;}};function g(i,k){if(i.getSetting){var j=i.getSetting("_ovpCache");if(j){return j[k];}}return undefined;}function s(i,k,j){if(i.getSetting){var k1=i.getSetting("_ovpCache");if(k1){k1[k]=j;}}}function a(i,j){if(!sap.ovp.cards.AnnotationHelper.formatFunctions[j]){sap.ovp.cards.AnnotationHelper.formatFunctions[j]=0;}sap.ovp.cards.AnnotationHelper.formatFunctions[j]++;var k=j+sap.ovp.cards.AnnotationHelper.formatFunctions[j];sap.ovp.cards.AnnotationHelper.formatFunctions[k]=i;return"sap.ovp.cards.AnnotationHelper.formatFunctions."+k;}function c(i,j){var k;if(j){k=j.None;if(i&&i.EnumMember){var k1=i.EnumMember;if(e(k1,'Negative')){k=j.Negative;}else if(e(k1,'Critical')){k=j.Critical;}else if(e(k1,'Positive')){k=j.Positive;}}}return k;}function b(i){if(i=="Error"){i=1;}else if(i=="Warning"){i=2;}else if(i=="Success"){i=3;}else{i=0;}return i;}function e(i,j){return i&&i.indexOf(j,i.length-j.length)!==-1;}function d(i,j,k,k1,l1,m1,n1){var o1={};o1.EnumMember="None";if(i!==undefined){i=Number(i);if(e(j,"Minimize")||e(j,"Minimizing")){if((m1!==undefined&&m1!==null)&&(k1!=undefined&&k1!=null)){if(i<=m1){o1.EnumMember="Positive";}else if(i>k1){o1.EnumMember="Negative";}else{o1.EnumMember="Critical";}}}else if(e(j,"Maximize")||e(j,"Maximizing")){if((l1!==undefined&&l1!==null)&&(k!==undefined&&k!==null)){if(i>=l1){o1.EnumMember="Positive";}else if(i<k){o1.EnumMember="Negative";}else{o1.EnumMember="Critical";}}}else if(e(j,"Target")){if((m1!==undefined&&m1!==null)&&(k1!=undefined&&k1!=null)&&(l1!==undefined&&l1!==null)&&(k!==undefined&&k!==null)){if(i>=l1&&i<=m1){o1.EnumMember="Positive";}else if(i<k||i>k1){o1.EnumMember="Negative";}else{o1.EnumMember="Critical";}}}}return c(o1,n1);}function f(i,j,k,k1){if(!i||!j){return;}i=Number(i);if(!k1&&(i-j>=0)){return"sap-icon://trend-up";}if(!k&&(i-j<=0)){return"sap-icon://trend-down";}if(j&&k1&&(i-j>=k1)){return"sap-icon://trend-up";}if(j&&k&&(i-j<=k)){return"sap-icon://trend-down";}}function h(i,j){var k=i.getPath()+"-DataFields-Sorted";var k1=g(i,k);if(!k1){var l1=l(i,j);var m1=l1.map(function(n1){return n1.Value.Path;});m1=m1.filter(function(n1){return!!n1;});k1=j.filter(function(n1){if(n1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&m1.indexOf(n1.Value.Path)===-1){return true;}return false;});k1=r(k1);s(i,k,k1);}return k1;}function l(j,k,k1){var l1=j.getPath()+"-DataPoints-Sorted";var m1=g(j,l1);if(!m1){if(k1){m1=k.filter(n);}else{m1=k.filter(m);}m1=r(m1);var n1;for(var i=0;i<m1.length;i++){n1=j.getPath().substr(0,j.getPath().lastIndexOf("/")+1);m1[i]=j.getModel().getProperty(p(n1,m1[i]));n1="";}s(j,l1,m1);}return m1;}function m(i){if(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;}function n(i){if((i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/))||(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/))){return true;}return false;}function o(i){if(!i||!i.Criticality||!i.Criticality.Path){return;}return"{path:'"+i.Criticality.Path+"'}";}function p(i,j){if(i&&!e(i,'/')){i+='/';}return i+j.Target.AnnotationPath.slice(1);}function q(i){var j,k;if(i["com.sap.vocabularies.UI.v1.Importance"]){j=i["com.sap.vocabularies.UI.v1.Importance"].EnumMember;switch(j){case"com.sap.vocabularies.UI.v1.ImportanceType/High":k=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":k=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":k=3;break;}}else{k=4;}return k;}function r(i){if(i.length<2){return i;}var j=parseInt(i.length/2,10);var k=i.slice(0,j);var k1=i.slice(j,i.length);return t(r(k),r(k1));}function t(i,j){var k=[];while(i.length&&j.length){var k1=q(i[0]),l1=q(j[0]);if(k1<=l1){k.push(i.shift());}else{k.push(j.shift());}}while(i.length){k.push(i.shift());}while(j.length){k.push(j.shift());}return k;}function u(i,j,k){var k1=h(i,j)[k];if(k1){return A(i,k1);}return"";}function v(i,j,k){var k1=h(i,j)[k];if(k1){return k1.Label.String;}return"";}function w(i,j,k){var k1=l(i,j)[k];if(k1&&k1.Title){return k1.Title.String;}return"";}function x(i,j,k){var k1=l(i,j)[k];if(!k1){return"";}var l1=i.getSetting('ovpCardProperties');var m1=l1.getProperty("/entityType");var n1=l1.getProperty("/metaModel");return _(i,k1,m1,n1);}function y(i,j,k){var k1=l(i,j)[k];if(k1&&k1.Criticality){return true;}}function z(i,j,k){var k1=l(i,j)[k];var l1=k1.Criticality.Path;return"{path:'"+l1+"'}";}function _(i,j,k,k1){if(!j||!j.Value){return"";}var l1=i.getSetting('ovpCardProperties');var m1=false;if(l1){var n1=l1.getProperty("/ignoreSapText");m1=n1==undefined?m1:n1;}var o1=k1.getODataProperty(k,j.Value.Path);var p1=false;if(m1==true){if(o1&&(o1["com.sap.vocabularies.Analytics.v1.Measure"]||o1["sap:aggregation-role"]=="measure")){p1=true;}}if(!p1&&o1){var q1;if(o1["com.sap.vocabularies.Common.v1.Text"]){q1=o1["com.sap.vocabularies.Common.v1.Text"].String?o1["com.sap.vocabularies.Common.v1.Text"].String:o1["com.sap.vocabularies.Common.v1.Text"].Path;}else if(o1["sap:text"]){q1=o1["sap:text"];}if(q1){o1=k1.getODataProperty(k,q1);j={Value:{Path:o1.name}};}}return A(i,j);}function A(i,j,k,k1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var l1=i.getSetting('ovpCardProperties');var m1=l1.getProperty("/entityType");var n1=l1.getProperty("/metaModel");return C(i,j,m1,n1,k,k1);}function B(i,j,k,k1){if((!k)||(typeof k1!=='string')){return k1;}var l1=k[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT];if(!l1){return k1;}var m1,n1;m1=k[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];n1=m1&&m1.EnumMember;if(!n1){m1=l1&&l1[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];n1=m1&&m1.EnumMember;}if(!n1){m1=j&&j[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];n1=m1&&m1.EnumMember;}if(!n1){return k1;}var o1=sap.ui.model.odata.AnnotationHelper.format(i,l1);if(!o1||o1===" "){return k1;}var p1;switch(n1){case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_FIRST:p1=o1+" ("+k1+")";break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_LAST:p1=k1+" ("+o1+")";break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_ONLY:p1=o1;break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_SEPARATE:p1=k1+" ("+o1+")";break;default:p1=k1;break;}return p1;}function C(i,j,k,k1,l1,m1,n1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var o1=k1.getODataProperty(k,j.Value.Path),p1="",q1;var r1=i.getSetting("ovpCardProperties");var s1=r1&&r1.getProperty("/contentFragment");if(!m1){if(j.Value.Path.split("/").length>1){o1=J(k1,k,j.Value.Path);}if(!o1){return"";}if(o1["type"]==='Edm.DateTime'||o1["type"]==='Edm.DateTimeOffset'){var t1=r1&&r1.getProperty("/showDateInRelativeFormat");q1=G("dateFormatFunction",t1);p1=D([j.Value.Path?j.Value.Path:o1.name],q1);}else if((j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)||o1["scale"]){var u1=(j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)?j.ValueFormat.NumberOfFractionalDigits.Int:0,v1;if(o1["Org.OData.Measures.V1.ISOCurrency"]){v1=o1["Org.OData.Measures.V1.ISOCurrency"].Path?o1["Org.OData.Measures.V1.ISOCurrency"].Path:o1["Org.OData.Measures.V1.ISOCurrency"].String;}else if(o1["Org.OData.Measures.V1.Unit"]){v1=o1["Org.OData.Measures.V1.Unit"].Path?o1["Org.OData.Measures.V1.Unit"].Path:o1["Org.OData.Measures.V1.Unit"].String;}else if(o1["sap:unit"]){v1=o1["sap:unit"];}var w1=v1?k1.getODataProperty(k,v1):null,x1=[j.Value.Path?j.Value.Path:o1.name];if(u1>2){u1=2;}if(o1["Org.OData.Measures.V1.ISOCurrency"]){var y1=o1["Org.OData.Measures.V1.ISOCurrency"];if(y1.Path){q1=H(u1);x1.push(y1.Path);}else if(y1.String){q1=H(u1,y1.String);}}else if(w1&&(w1["Org.OData.Measures.V1.ISOCurrency"]||w1["sap:semantics"]==="currency-code")){q1=H(u1);x1.push(v1);}else{q1=E(u1);}p1=D(x1,q1);}else{if(n1){p1=sap.ui.model.odata.AnnotationHelper.simplePath(i,j.Value);}else{p1=sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}}if(s1&&s1==="sap.ovp.cards.table.Table"){p1=B(i,k,o1,p1);}if(o1["Org.OData.Measures.V1.Unit"]){var z1=o1["Org.OData.Measures.V1.Unit"];if(z1.Path){p1+=(" "+D([z1.Path]));}else if(z1.String){if(z1.String!=="%"){p1+=" ";}p1+=z1.String;}}}if(!l1){if(o1["Org.OData.Measures.V1.ISOCurrency"]){var y1=o1["Org.OData.Measures.V1.ISOCurrency"];if(y1.Path){p1+=(" "+D([y1.Path]));}else if(y1.String){p1+=(" "+y1.String);}}}if(p1[0]===" "){p1=p1.substring(1);}return p1;}function D(j,k){var k1="",l1=j.length;if(l1>1){k1="{parts:[";for(var i=0;i<l1;i++){k1+=("{path: '"+j[i]+"'}"+((i===l1-1)?"]":", "));}}else{k1="{path: '"+j[0]+"'";}k1+=(k?(", formatter: '"+k+"'"):"")+"}";return k1;}function E(i){var j="formatNumberCalculation"+i;if(!sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]){sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]=F(Number(i));}return"sap.ovp.cards.AnnotationHelper.NumberFormatFunctions."+j;}function F(i){return function(j){var k=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});return k.format(Number(j));};}function G(i,j){var k={'relative':true,'relativeScale':'auto'};if(j!==undefined&&!j){k={'style':'medium'};}if(!sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]){sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]=function(k1){var l1=sap.ui.core.format.DateFormat.getInstance(k);if(!k1){k1="";return k1;}return l1.format(new Date(k1));};}return"sap.ovp.cards.AnnotationHelper.DateFormatFunctions."+i;}function H(i,j){var k="formatCurrencyCalculation"+(j?j+i:i);if(!sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]){sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]=I(i,j);}return"sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions."+k;}function I(i,j){return function(k,k1){var l1="";var m1=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});if(k1){l1=m1.format(k,k1);}else{l1=j?m1.format(k,j):m1.format(k);}return l1;};}function J(j,k,k1){var l1=k1.split("/");if(l1.length>1){for(var i=0;i<(l1.length-1);i++){var m1=j.getODataAssociationEnd(k,l1[i]);if(m1){k=j.getODataEntityType(m1.type);}}return j.getODataProperty(k,l1[l1.length-1]);}}function K(i,j,k){var k1=l(i,j);var l1="None",m1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;if(k1.length>k){var n1=k1[k];if(n1&&n1.Criticality){l1=N(i,n1,m1);}else{l1=P(i,n1,m1);}}return l1;}function L(i,j,k){var k1=l(i,j);if(k1&&k1.length){var l1=k1[0];if(l1&&(l1.Criticality||l1.CriticalityCalculation)){return true;}}return false;}sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart=function(i,j,k){if(L(i,j,k)){return'';}return'#5cbae6';};function M(i,j,k){var k1=l(i,j),l1="None",m1=sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues;if(k1.length>k){var n1=k1[k];if(n1&&n1.Criticality){l1=N(i,n1,m1);}else{l1=P(i,n1,m1);}}return l1;}function N(i,j,k){var k1=sap.ui.core.ValueState.None;var l1;var m1=j.Criticality;if(m1){l1="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+k.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+k.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+k.Positive+"'' : "+"''"+k.None+"'' '}'";if(m1.Path){var n1='$'+sap.ui.model.odata.AnnotationHelper.simplePath(i,m1);k1=jQuery.sap.formatMessage(l1,n1);}else if(m1.EnumMember){var o1="'"+m1.EnumMember+"'";k1=jQuery.sap.formatMessage(l1,o1);}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return k1;}function O(i,j,k){var k1=l(i,j);var l1="None";if(k1.length>k){var m1=k1[k];if(m1&&m1.Criticality&&m1.Criticality.Path){l1=z(i,j,k);}else{l1=P(i,m1,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);l1=b(l1);}}return l1;}function P(i,j,k){var k1=k.None;if(j.Criticality){k1=c(j.Criticality,k);}else if(j.CriticalityCalculation&&j.Value&&j.Value&&j.Value.Path){k1=Q(i,j,k);}return k1;}function Q(i,j,k){var k1=a1(j.Value);var l1=j.CriticalityCalculation.ImprovementDirection.EnumMember;var m1=a1(j.CriticalityCalculation.DeviationRangeLowValue);var n1=a1(j.CriticalityCalculation.DeviationRangeHighValue);var o1=a1(j.CriticalityCalculation.ToleranceRangeLowValue);var p1=a1(j.CriticalityCalculation.ToleranceRangeHighValue);var q1=R(m1);var r1=R(n1);var s1=R(o1);var t1=R(p1);var u1="parts: ["+k1;u1+=q1?","+m1:"";u1+=r1?","+n1:"";u1+=s1?","+o1:"";u1+=t1?","+p1:"";u1+="]";var v1=function(){var x1=1;return d(arguments[0],l1,q1?arguments[x1++]:m1,r1?arguments[x1++]:n1,s1?arguments[x1++]:o1,t1?arguments[x1++]:p1,k);};var w1=a(v1,"formatCriticalityCalculation");return"{"+u1+", formatter: '"+w1+"'}";}function R(i){return(typeof i==="string")&&i.charAt(0)==="{";}function S(j,k,k1){var l1="";var m1=k1.split("/");if(m1.length>1){for(var i=0;i<(m1.length-1);i++){var n1=j.getODataAssociationEnd(k,m1[i]);if(n1){k=j.getODataEntityType(n1.type);if(l1){l1=l1+"/";}l1=l1+m1[i];}else{return l1;}}}return l1;}sap.ovp.cards.AnnotationHelper.formatField=function(i,j){return A(i,j);};sap.ovp.cards.AnnotationHelper.formatItems=function(i,j){var k=i.getSetting('ovpCardProperties');var k1=k.getProperty("/addODataSelect");var l1=k.getProperty("/metaModel");var m1=l1.getODataEntityType(j.entityType);var n1=m1[k.getProperty('/selectionAnnotationPath')];var o1=m1[k.getProperty('/presentationAnnotationPath')];var p1="/"+j.name;var q1=Array.prototype.slice.call(arguments,2);if(n1){if(n1&&n1.Parameters&&n1.Parameters.length>0){p1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(i.getSetting('dataModel'),j,n1);}}if(k.getProperty("/cardLayout")&&k.getProperty("/cardLayout/noOfItems")){var r1="{path: '"+p1+"', length: "+ +(k.getProperty("/cardLayout/noOfItems"));}else{var r1="{path: '"+p1+"', length: "+c1(k);}var s1=[];if(k1){s1=U(i,l1,m1,q1);}var t1=T(l1,m1,q1);if(s1.length>0||t1.length>0){r1=r1+", parameters: {";if(s1.length>0){r1=r1+"select: '"+s1.join(',')+"'";}if(t1.length>0){if(s1.length>0){r1=r1+", ";}r1=r1+"expand: '"+t1.join(',')+"'";}r1=r1+"}";}var u1=W(k,o1);if(u1.length>0){r1=r1+", sorter:"+JSON.stringify(u1);}var v1=Y(k,n1);if(v1.length>0){r1=r1+", filters:"+JSON.stringify(v1);}r1=r1+"}";return r1;};function T(k,k1,l1){var m1=[];var n1,o1,p1,q1;for(var i=0;i<l1.length;i++){if(!l1[i]){continue;}n1=k1.$path+"/"+l1[i];o1=k.createBindingContext(n1);p1=o1.getObject();p1=p1?p1:[];for(var j=0;j<p1.length;j++){if(p1[j].Value&&p1[j].Value.Path){q1=S(k,k1,p1[j].Value.Path);if(q1&&m1.indexOf(q1)===-1){m1.push(q1);}}}}return m1;}function U(k1,l1,m1,n1){var o1=[];var p1,q1,r1;for(var i=0;i<n1.length;i++){if(!n1[i]){continue;}p1=m1.$path+"/"+n1[i];q1=l1.createBindingContext(p1);var s1={};if(k1&&k1.bDummyContext){jQuery.extend(s1,k1,q1,true);}else{s1=k1;}r1=q1.getObject();if(!r1){r1=[];}else if(jQuery.isPlainObject(r1)){if(r1.Data){r1=r1.Data;}else{r1=[];}}var t1;var u1;var v1;var w1;for(var j=0;j<r1.length;j++){u1=[];t1=r1[j];v1="";w1=t1.RecordType;if(w1==="com.sap.vocabularies.UI.v1.DataField"){v1=C(s1,t1,m1,l1,undefined,undefined,true);}else if(w1==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var x1=p(m1.$path,t1);v1=_(s1,l1.getProperty(x1),m1,l1);var y1=o(l1.getProperty(x1));if(y1&&y1.length>0){v1+=y1;}}else if(w1==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&t1.Url){var z1;if(!t1.Url.UrlRef){z1=sap.ui.model.odata.AnnotationHelper.format(s1,t1.Url);}if(z1&&z1.substring(0,2)==="{="){v1=z1;}}if(v1){u1=V(v1);}if(u1&&u1.length>0){var A1;for(var k=0;k<u1.length;k++){A1=u1[k];if(!o1[A1]){o1[A1]=true;var B1=sap.ovp.cards.CommonUtils.getUnitColumn(A1,m1);if(B1&&B1!==A1){o1[B1]=true;}var C1=i1(l1,m1,A1);if(C1&&C1!==A1){o1[C1]=true;}}}}}}return Object.keys(o1);}function V(j){var i,k=0,k1=j.length,l1="",m1;for(i=0;i<k1;i++){m1=j.charAt(i);if(!m1){return;}switch(m1){case"{":k++;break;case"}":k--;break;default:if(k<=0){continue;}break;}l1+=m1;}j=l1;var n1=/\${([a-zA-Z0-9\_|\/]*)/g;var o1=/[^[{]*[a-zA-Z0-9\_]/g;var p1=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var q1,r1,s1=[];if(j.indexOf("{parts:[")!==-1){j=j.replace("{parts:[","");}if(j.substring(0,2)==="{="){q1=n1;r1=1;}else if(j.indexOf("path")!==-1){var t1=o1.exec(j);while(t1){if(t1[0].indexOf("path")===-1&&t1[0].indexOf("@i18n")!==0){s1.push(t1[0]);}t1=o1.exec(j);}q1=p1;r1=1;}else{q1=o1;r1=0;}var u1=q1.exec(j);while(u1){if(u1[r1]&&u1[r1].indexOf("@i18n")!==0){s1.push(u1[r1]);}u1=q1.exec(j);}return s1;}function W(j,k){var k1=[];var l1,m1;var n1=j.getProperty("/sortBy");if(n1){var o1=j.getProperty('/sortOrder');if(o1&&o1.toLowerCase()!=='descending'){m1=false;}else{m1=true;}l1={path:n1,descending:m1};k1.push(l1);}var p1=k&&k.SortOrder||undefined;var q1,n1;if(p1){for(var i=0;i<p1.length;i++){q1=p1[i];n1=q1.Property.PropertyPath;m1=Z(q1.Descending,true);l1={path:n1,descending:m1};k1.push(l1);}}return k1;}sap.ovp.cards.AnnotationHelper.getCardSelections=function(i){var j=i.getProperty('/entityType');var k=j[i.getProperty('/selectionAnnotationPath')];return{filters:Y(i,k),parameters:X(k)};};sap.ovp.cards.AnnotationHelper.getCardSorters=function(j){if(!j){return;}var k=j.getProperty('/entityType');var k1=k[j.getProperty('/presentationAnnotationPath')];var l1=W(j,k1);var m1=[];var i,n1=l1.length;for(i=0;i<n1;i++){if(!l1[i].path){continue;}m1.push({Property:l1[i].path,Descending:l1[i].descending});}if(m1.length>0){return{SortOrder:m1};}};function X(j){var k,k1=[];if(!j||!j.Parameters){return k1;}var l1=j.Parameters.length;for(var i=0;i<l1;i++){k=j.Parameters[i];if(!k.PropertyName||!k.PropertyName.PropertyPath){continue;}if(!k.PropertyValue){jQuery.sap.log.error("Missing value for parameter "+k.PropertyName.PropertyPath);continue;}k1[k1.length]={path:k.PropertyName.PropertyPath,value:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(k.PropertyValue)};}return k1;}function Y(k,k1){var l1=[];var m1;var n1=k.getProperty("/filters");if(n1){l1=l1.concat(n1);}if(k1&&k1.SelectOptions){m1=k1.SelectOptions;}else{m1=k1;}var o1,p1,q1;if(m1){for(var i=0;i<m1.length;i++){o1=m1[i];p1=o1.PropertyName.PropertyPath;for(var j=0;j<o1.Ranges.length;j++){q1=o1.Ranges[j];if(q1.Sign.EnumMember){var r1={path:p1,operator:q1.Option.EnumMember.split("/")[1],value1:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(q1.Low),value2:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(q1.High),sign:q1.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(r1.sign==="E"&&r1.operator!==sap.ui.model.FilterOperator.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");continue;}if(r1.sign==="E"&&r1.operator===sap.ui.model.FilterOperator.EQ){r1.operator=sap.ui.model.FilterOperator.NE;r1.sign="I";}l1.push(r1);}}}}return l1;}function Z(i,j){if(i&&i.Boolean){if(i.Boolean.toLowerCase()==="true"){return true;}else if(i.Boolean.toLowerCase()==="false"){return false;}}else if(i&&i.Bool){if(i.Bool.toLowerCase()==="true"){return true;}else if(i.Bool.toLowerCase()==="false"){return false;}}return j;}function $(i){var j;if(i){if(i.String){j=Number(i.String);}else if(i.Int){j=Number(i.Int);}else if(i.Decimal){j=Number(i.Decimal);}else if(i.Double){j=Number(i.Double);}else if(i.Single){j=Number(i.Single);}}return j;}sap.ovp.cards.AnnotationHelper.getPrimitiveValue=function(i){var j;if(i){if(i.String||i.String===""){j=i.String;}else if(i.Boolean||i.Bool){j=Z(i);}else{j=$(i);}}return j;};function a1(i){if(i){if(i.Path){return"{path:'"+i.Path+"'}";}else{return sap.ovp.cards.AnnotationHelper.getPrimitiveValue(i);}}else{return"";}}var b1={"List_condensed":{phone:5,tablet:5,desktop:5},"List_extended":{phone:3,tablet:3,desktop:3},"List_condensed_bar":{phone:5,tablet:5,desktop:5},"List_extended_bar":{phone:3,tablet:3,desktop:3},"Table":{phone:5,tablet:5,desktop:5},"Stack_simple":{phone:20,tablet:20,desktop:20},"Stack_complex":{phone:5,tablet:5,desktop:5}};function c1(i){var j=i.getProperty('/contentFragment');var k=i.getProperty('/listType');var k1=i.getProperty('/listFlavor');var l1;var m1="desktop";if(sap.ui.Device.system.phone){m1="phone";}else if(sap.ui.Device.system.tablet){m1="tablet";}if(j=="sap.ovp.cards.list.List"){if(k=="extended"){if(k1=="bar"){l1=b1["List_extended_bar"];}else{l1=b1["List_extended"];}}else if(k1=="bar"){l1=b1["List_condensed_bar"];}else{l1=b1["List_condensed"];}}else if(j=="sap.ovp.cards.table.Table"){l1=b1["Table"];}else if(j=="sap.ovp.cards.stack.Stack"){if(i.getProperty('/objectStreamCardsNavigationProperty')){l1=b1["Stack_complex"];}else{l1=b1["Stack_simple"];}}if(l1){return l1[m1];}return 5;}sap.ovp.cards.AnnotationHelper.removeDuplicateDataField=function(i){var j=i.getObject();var k=l(i,j,true);var k1=k.map(function(l1){if(l1&&l1.Value&&l1.Value.Path){return l1.Value.Path;}else if(l1&&l1.fn&&l1.fn.Path){return l1.fn.Path;}});j.filter(function(l1,m1){if(l1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&k1.indexOf(l1.Value.Path)>-1){j.splice(m1,1);}});};sap.ovp.cards.AnnotationHelper.formatUrl=function(i,j){if(j.charAt(0)==='/'||j.indexOf("http")===0){return j;}var k=i.getModel().getProperty("/baseUrl");if(k){return k+"/"+j;}return j;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(i,j){var k=l(i,j);return k.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(i,j,k){var k1=l(i,j),l1=k1[k];if(l1&&l1.Value&&l1.Value.Path){return l1.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(i,j){return v(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(i,j){return v(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(i,j){return v(i,j,2);};sap.ovp.cards.AnnotationHelper.getFourthDataFieldName=function(i,j){return v(i,j,3);};sap.ovp.cards.AnnotationHelper.getFifthDataFieldName=function(i,j){return v(i,j,4);};sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue=function(i,j){return u(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue=function(i,j){return u(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue=function(i,j){return u(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue=function(i,j){return u(i,j,3);};sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue=function(i,j){return u(i,j,4);};sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue=function(i,j){return u(i,j,5);};sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric=function(i,j,k){return e1(i,j,k);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(i,j){return w(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(i,j){return w(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(i,j){return w(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue=function(i,j){return x(i,j,0);};sap.ovp.cards.AnnotationHelper.formatImageUrl=function(j,k){for(var i=0;i<k.length;i++){var k1=k[i];if(k1.RecordType==="com.sap.vocabularies.UI.v1.DataField"){if(k1.IconUrl&&k1.IconUrl.String){return k1.IconUrl.String;}if(k1.IconUrl&&k1.IconUrl.Path){return sap.ui.model.odata.AnnotationHelper.simplePath(j,k1.IconUrl);}}}};sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue=function(i,j){return x(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue=function(i,j){return x(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(i,j){return K(i,j,0);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor=function(i,j){return M(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(i,j){return K(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(i,j){return K(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField=function(i,j){return O(i,j,0);};sap.ovp.cards.AnnotationHelper.formatKPIHeaderState=function(i,j){return P(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality=function(i,j){return y(i,j,0);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticalityForTableStatus=function(i,j){var k=l(i,j)[0];if(k&&(k.Criticality||k.CriticalityCalculation)){return true;}return false;};sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality=function(i,j){return y(i,j,1);};sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality=function(i,j){return y(i,j,2);};sap.ovp.cards.AnnotationHelper.getSortedDataFields=function(i,j){return h(i,j);};sap.ovp.cards.AnnotationHelper.getSortedDataPoints=function(i,j){return l(i,j);};function d1(i,j){var k=i.getPath();var k1=k.slice(0,k.lastIndexOf("/"));k1=k1.slice(0,k1.lastIndexOf("/"));var l1=p(k1,j);j=i.getModel().getProperty(l1);return j;}sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric=function(i,j){if(!j){return"";}return A(i,j);};function e1(j,k,k1,l1){var m1;var n1=l1==undefined?k1:h(j,k1)[l1];var o1=j.getSetting('ovpCardProperties');var p1=o1.getProperty("/metaModel");var q1=p1.getODataEntityType(k.entityType);var r1=q1.property;if(r1){for(var i=0;i<r1.length;i++){if(n1.Value.Path===r1[i].name){m1=r1[i]["com.sap.vocabularies.Common.v1.SemanticObject"];if(m1){return sap.ui.model.odata.AnnotationHelper.format(j,m1);}else{return"";}}}}}sap.ovp.cards.AnnotationHelper.formatDataPointValue=function(i,j){if(!j){return"";}var k=i.getSetting('ovpCardProperties');var k1=k.getProperty("/entityType");var l1=k.getProperty("/metaModel");var m1=jQuery.extend({},j);var n1=jQuery.extend({},i);j=d1(n1,m1);return _(i,j,k1,l1);};sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric=function(i,j){var k=jQuery.extend({},j);var k1=jQuery.extend({},i);var l1="None",m1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;j=d1(k1,k);if(j&&j.Criticality){l1=N(i,j,m1);}else{l1=P(i,j,m1);}return l1;};sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric=function(i,j){var k=jQuery.extend({},j);var k1=jQuery.extend({},i);j=d1(k1,k);if(j&&j.Criticality){return true;}};sap.ovp.cards.AnnotationHelper.checkCriticalityGenericForTableStatus=function(i,j){var k=jQuery.extend({},j);var k1=jQuery.extend({},i);var l1=i.getSetting('ovpCardProperties');var m1=l1.getProperty("/entityType");var n1=l1.getProperty("/metaModel");j=d1(k1,k);if(!j){return;}var o1=n1.getODataProperty(m1,j.Value.Path);if(j&&o1&&o1.type=="Edm.String"&&(j.Criticality||j.CriticalityCalculation)){return true;}};sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric=function(i,j){var k=jQuery.extend({},j);var k1=jQuery.extend({},i);j=d1(k1,k);var l1="None";if(j&&j.Criticality&&j.Criticality.Path){l1="{path:'"+j.Criticality.Path+"'}";}else{l1=P(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);l1=b(l1);}return l1;};sap.ovp.cards.AnnotationHelper.hasActions=function(j,k){var k1;for(var i=0;i<k.length;i++){k1=k[i];if(k1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||k1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||k1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1;}}return 0;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(i,j){var k=l(i,j)[0];if(k&&k.Value&&k.Value.Path){var k1=i.getPath().substr(0,i.getPath().lastIndexOf("/")+1);var l1=i.getModel();var m1=l1.getProperty(k1);var n1=l1.getODataProperty(m1,k.Value.Path);if(n1&&n1["Org.OData.Measures.V1.Unit"]){return n1["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(i){var j=i.getObject();var k=i.getModel();var k1=k.getProperty("/metaModel");var l1=k1.getODataEntitySet(k.getProperty("/entitySet"));var m1=k1.getODataEntityType(l1.entityType);j=m1.$path+"/"+j;return k1.createBindingContext(j);};sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet=function(i,j,k){jQuery.sap.require("sap.ui.model.analytics.odata4analytics");var k1="";var l1=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(i));var m1=l1.findQueryResultByName(j.name);if(!m1){k1="/"+j.name;jQuery.sap.log.error("findQueryResultByName","Entity Set not found in the QueryResultRequest");return k1;}var n1=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(m1);var o1=m1.getParameterization();if(o1){var p1;n1.setParameterizationRequest(new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(o1));jQuery.each(k.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){p1=this.PropertyNameFrom.PropertyPath.split("/");n1.getParameterizationRequest().setParameterValue(p1[p1.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String);}else{p1=this.PropertyName.PropertyPath.split("/");n1.getParameterizationRequest().setParameterValue(p1[p1.length-1],this.PropertyValue.String);}});}try{k1=n1.getURIToQueryResultEntitySet();}catch(q1){m1=n1.getQueryResult();k1="/"+m1.getEntitySet().getQName();jQuery.sap.log.error("getEntitySetPathWithParameters","binding path with parameters failed - "+q1||q1.message);}return k1;};sap.ovp.cards.AnnotationHelper.getAssociationObject=function(j,k,ns){var k1=j.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<k1.length;i++){if(ns+"."+k1[i].name===k){return k1[i];}}};sap.ovp.cards.AnnotationHelper.getAggregateNumber=function(i,j,k,k1){var l1,m1,n1;if(k&&k.Value&&k.Value.Path){l1=k.Value.Path;}else if(k&&k.Description&&k.Description.Value&&k.Description.Value.Path){l1=k.Description.Value.Path;}if(k&&k.Description&&k.Description.Path){m1=k.Description.Path;}else if(k&&k.Title&&k.Title.Path){n1=k.Title.Path;}var o1="";var p1=k1&&k1.Parameters;var q1="";if(p1){var r1=i.getSetting("dataModel");var s1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(r1,j,k1);o1+="{path: '"+s1+"'";}else{o1+="{path: '/"+j.name+"'";}o1+=", length: 1";var t1=i.getSetting('ovpCardProperties');var u1=t1.getProperty("/entityType");var v1=sap.ovp.cards.CommonUtils.getUnitColumn(l1,u1);var w1=Y(t1,k1);if(w1.length>0){q1+=", filters: "+JSON.stringify(w1);}var x1=[];x1.push(l1);if(m1){x1.push(m1);}else if(n1){x1.push(n1);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeLowValue&&k.CriticalityCalculation.DeviationRangeLowValue.Path){x1.push(k.CriticalityCalculation.DeviationRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeLowValue&&k.CriticalityCalculation.ToleranceRangeLowValue.Path){x1.push(k.CriticalityCalculation.ToleranceRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeHighValue&&k.CriticalityCalculation.DeviationRangeHighValue.Path){x1.push(k.CriticalityCalculation.DeviationRangeHighValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeHighValue&&k.CriticalityCalculation.ToleranceRangeHighValue.Path){x1.push(k.CriticalityCalculation.ToleranceRangeHighValue.Path);}if(v1){x1.push(v1);}if(k&&k.TrendCalculation&&k.TrendCalculation.ReferenceValue&&k.TrendCalculation.ReferenceValue.Path){x1.push(k.TrendCalculation.ReferenceValue.Path);}return o1+", parameters:{select:'"+x1.join(",")+"'}"+q1+"}";};sap.ovp.cards.AnnotationHelper.KpiValueFormatter=function(k){if(isNaN(k)){return k;}var i,j,k1=false;if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){i=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.percentageAvailable){k1=true;}if(!i||i<0){i=0;}else if(i>2){i=2;}j=k;if(k){var l1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:i,maxFractionDigits:i,style:"short",showScale:true,shortRefNumber:j});if(k1){return l1.format(Number(k))+" %";}else{return l1.format(Number(k));}}};sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber=function(i){if(!i||!i.Value||!i.Value.Path){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var k1=j.getProperty("/metaModel");var l1=k1.getODataProperty(k,i.Value.Path);if(l1["Org.OData.Measures.V1.Unit"]){var m1=l1["Org.OData.Measures.V1.Unit"];if(m1.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true;}}return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.KpiValueFormatter'}";};sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon=function(i,j){if(!j||!j.Value||!j.Value.Path||!j.TrendCalculation){return"";}var k=a1(j.Value);var k1=a1(j.TrendCalculation.ReferenceValue);var l1=a1(j.TrendCalculation.DownDifference);var m1=a1(j.TrendCalculation.UpDifference);var n1=R(k1);var o1=R(l1);var p1=R(m1);var q1="parts: ["+k;q1+=n1?","+k1:"";q1+=o1?","+l1:"";q1+=p1?","+m1:"";q1+="]";var r1=function(){var t1=1;return f(arguments[0],n1?arguments[t1++]:k1,o1?arguments[t1++]:l1,p1?arguments[t1++]:m1);};var s1=a(r1,"formatTrendDirection");return"{"+q1+", formatter: '"+s1+"'}";};sap.ovp.cards.AnnotationHelper.formThePathForSubtitle=function(i,j,k){var k1,l1;if(!j||!j.Value||!j.Value.Path){return k;}k1=A(i,j,false,true);l1=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("SubTitle_IN");if(k1){return k+" "+l1+" "+k1;}else{return k;}};sap.ovp.cards.AnnotationHelper.formPathForPercentageChange=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}if(i.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+i.Value.Path+"'}, {path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}else{return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}};sap.ovp.cards.AnnotationHelper.TargetValueFormatter=function(k,i){var j,k1,l1,m1=false;if(isNaN(k)){return"";}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){k1=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.percentageAvailableForTarget){m1=true;}if(!k1||k1<0){k1=0;}else if(k1>2){k1=2;}if(k==0){l1=i;}else{l1=k;}if(i){j=i;}else if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.ManifestTargetValue){j=this.oPropagatedProperties.oModels.ovpCardProperties.oData.ManifestTargetValue;}if(j){var n1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:k1,maxFractionDigits:k1,style:"short",showScale:true,shortRefNumber:l1});if(m1){return n1.format(Number(j))+" %";}else{return n1.format(Number(j));}}};sap.ovp.cards.AnnotationHelper.formPathForTargetValue=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(!i||!i.Value||!i.Value.Path){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}if(i.TrendCalculation.ReferenceValue){if(i.TrendCalculation.ReferenceValue.String){this.getModel("ovpCardProperties").oData.ManifestTargetValue=i.TrendCalculation.ReferenceValue.String;return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}if(i.TrendCalculation.ReferenceValue.Path){var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var k1=j.getProperty("/metaModel");var l1=k1.getODataProperty(k,i.TrendCalculation.ReferenceValue.Path);if(l1["Org.OData.Measures.V1.Unit"]){var m1=l1["Org.OData.Measures.V1.Unit"];if(m1.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailableForTarget=true;}}return"{parts: [{path:'"+i.Value.Path+"'},{path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}}};sap.ovp.cards.AnnotationHelper.returnPercentageChange=function(i,j){jQuery.sap.require("sap.ui.core.format.NumberFormat");var k="";var k1;if(isNaN(i)){return"";}i=Number(i);var l1=this.getModel("ovpCardProperties");if(!l1){return k;}var m1=l1.getProperty("/dataPointAnnotationPath");var n1=l1.getProperty("/entityType")[m1];var o1;if(!n1.TrendCalculation){return k;}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){k1=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(!k1||k1<0){k1=0;}else if(k1>2){k1=2;}if(n1.TrendCalculation.ReferenceValue){if(n1.TrendCalculation.ReferenceValue.String){o1=Number(n1.TrendCalculation.ReferenceValue.String);}if(n1.TrendCalculation.ReferenceValue.Path){o1=Number(j);}if(!o1||o1==0){return k;}var p1=((Number(i)-o1)/o1);var q1=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:k1,maxFractionDigits:k1,showScale:true});return q1.format(p1);}};sap.ovp.cards.AnnotationHelper.isPresentationVarientPresent=function(i){if(i&&i.GroupBy&&!(jQuery.isEmptyObject(i.GroupBy))&&i.GroupBy[0].hasOwnProperty('PropertyPath')){return true;}else{return false;}};sap.ovp.cards.AnnotationHelper.listGroupBy=function(i){var j="";var k=i&&i.GroupBy;if(!k){return j;}var k1=this.getModel('ovpCardProperties').getProperty("/metaModel");var l1=this.getModel('ovpCardProperties').getProperty("/entityType");var m1;if(i.GroupBy.constructor===Array){m1=i.GroupBy;}else if(!i.GroupBy.Collection){return j;}else{m1=i.GroupBy.Collection;}var n1;jQuery.each(m1,function(){n1=h1(k1,l1,this.PropertyPath);if(!n1){return;}j+=n1;j+=", ";});if(j[j.length-1]===" "&&j[j.length-2]===","){j=j.substring(0,j.length-2);}return j==""?"":sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("By",[j]);};sap.ovp.cards.AnnotationHelper.formTheFilterByString=function(i,j,k){var k1=true;var l1=k["SelectOptions"].length-1;if(j.PropertyName.PropertyPath===k["SelectOptions"][l1].PropertyName.PropertyPath){k1=false;}j=[j];var m1=i.getSetting('ovpCardProperties');var n1=m1.getProperty("/entityType");var o1=m1.getProperty("/metaModel");var p1=Y(m1,j);if(p1.length==0){return"";}var q1;var r1;q1=p1[0].path;r1=i1(o1,n1,q1);if(r1!==q1){return"";}var s1=f1(p1);if(k1===true){return s1+", ";}return s1;};sap.ovp.cards.AnnotationHelper.formTheIdForFilter=function(i){return i.id;};function f1(j){var k=[];for(var i=0;i<j.length;i++){k.push(g1(j[i]));}return k.join(', ');}function g1(i){var j=false;var k=i.value1;if(i.operator[0]==="N"){j=true;}if(i.value2){k+=" - "+i.value2;}if(j){k=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("kpiHeader_Filter_NotOperator",[k]);}return k;}function h1(i,j,k){return j1(i,j,k,"com.sap.vocabularies.Common.v1.Label");}function i1(i,j,k){return j1(i,j,k,"sap:text");}function j1(i,j,k,k1){var l1=i.getODataProperty(j,k);if(!l1){jQuery.sap.log.error("No Property Found for with Name '"+k+" For Entity-Type '"+j.name+"'");return;}var m1=l1[k1];if(m1){if(k1==="com.sap.vocabularies.Common.v1.Label"){return m1.String;}return m1;}return l1.name;}sap.ovp.cards.AnnotationHelper._criticality2state=c;sap.ovp.cards.AnnotationHelper._calculateCriticalityState=d;sap.ovp.cards.AnnotationHelper._calculateTrendDirection=f;sap.ovp.cards.AnnotationHelper._getPropertiesFromBindingString=V;sap.ovp.cards.AnnotationHelper.sortCollectionByImportance=r;sap.ovp.cards.AnnotationHelper.formatterGeo.requiresIContext=true;sap.ovp.cards.AnnotationHelper.analyticRegions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.criticalityType.requiresIContext=true;sap.ovp.cards.AnnotationHelper.labelText.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForSubtitle.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByString.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFourthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFifthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor.requiresIContext=true;sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatKPIHeaderState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatImageUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticalityForTableStatus.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGenericForTableStatus.requiresIContext=true;sap.ovp.cards.AnnotationHelper.removeDuplicateDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataPoints.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataFields.requiresIContext=true;}());
